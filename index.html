   
<!DOCTYPE html>        
<html lang="ko">        
<head>        
<meta charset="UTF-8">        
<meta name="viewport" content="width=device-width, initial-scale=1.0">        
<title>MOONBYUL SCHEDULE</title>        
<style>        
body { margin:0; font-family:sans-serif; background:#f5f5f5; }        
header { background:#140bb6; color:white; padding:16px 15px; text-align:center; position:relative; }        
#siteTitle { font-size:40px; font-weight:bold; margin-bottom:6px; }        
#navControls { display:flex; justify-content:center; align-items:center; gap:8px; position:relative; }        
#todayBtn { position:absolute; right:10px; }        
#weekdays,#calendar { display:grid; grid-template-columns:repeat(7,1fr); }        
#weekdays { gap:6px; padding:6px 10px; }        
#calendar { gap:6px; padding:6px 10px; margin-bottom:400px; }        
.weekday { text-align:center; font-weight:bold; background:#eee; border-radius:6px; padding:5px 0; font-size:12px; }        
.day { background:white; border-radius:10px; padding:6px; min-height:140px; display:flex; flex-direction:column; border:2px solid transparent; overflow:hidden; cursor:pointer; user-select: none; -webkit-tap-highlight-color: transparent; }        
.day.today { border-color:#4f46e5; background:#eef2ff; }        
.day.selected { border-color:#181818; }        
.day-number { font-size:12px; font-weight:bold; text-align:center; height:20px; }        
.schedule-container { flex:1; overflow-y:auto; }        
.schedule {        
  display: flex;        
  flex-direction: column; /* ì¶”ê°€: row -> column */        
  align-items: flex-start; /* ì™¼ìª½ ì •ë ¬ */        
  font-size: 8.5px;        
  border-radius: 4px;        
  padding: 2px 4px;        
  margin-bottom: 3px;        
  cursor: pointer;        
  user-select: none;        
  box-sizing: border-box;        
  white-space: normal;        
  word-break: break-word;        
  /* ì¶”ê°€: ì˜ì–´ ë‹¨ì–´ë„ ê¸€ì ë‹¨ìœ„ë¡œ ì¤„ë°”ê¿ˆ */        
  overflow-wrap: break-word;   /* ê¸´ ë‹¨ì–´ ì¤„ë°”ê¿ˆ í—ˆìš© */        
  word-break: break-all;       /* ëª¨ë“  ê¸€ì ë‹¨ìœ„ ì¤„ë°”ê¿ˆ */        
  overflow: visible;        
}        
        
.schedule .link-icon {        
  margin: 0 0 4px 0; /* ì•„ë˜ìª½ ì—¬ë°± */        
  cursor: pointer;        
}        
.schedule.dragging { opacity:0.5; transform:scale(0.95); }        
        
.schedule .title { flex:1; }        
#inputBox { position:fixed; bottom:0; left:0; right:0; height:auto; background:white; padding:10px; border-top:1px solid #ddd; display:none; z-index:1000; overflow-y:auto; box-sizing:border-box; }        
#inputBox label { display:block; margin-top:6px; font-size:12px; font-weight:bold; }        
#inputBox input, #inputBox select { width:100%; padding:6px; margin-top:2px; margin-bottom:6px; box-sizing:border-box; }        
#typeInput, #editTypeInput { -webkit-appearance: none; -moz-appearance: none; appearance: none; background: #fff url('data:image/svg+xml;utf8,<svg fill="black" height="12" viewBox="0 0 24 24" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 8px center; padding-right: 24px; border:1px solid #ccc; border-radius:6px; cursor:pointer; }        
#closeInputBtn { float:right; border:none; background:none; font-size:18px; margin-bottom:4px; }        
#addBtn { float:right; }        
#modalLink { font-size:13px; margin-bottom:6px; }        
.date-row { display:flex; gap:6px; margin-bottom:6px; }        
.date-row input { flex:1; box-sizing:border-box; }        
.modal { position:fixed; inset:0; background:rgba(0,0,0,0.4); display:none; justify-content:center; align-items:center; z-index:1000; overflow-y:auto; }        
.modal-content { background:white; padding:18px; border-radius:12px; width:85%; max-width:320px; box-sizing:border-box; }        
.modal-content label { display:block; margin-top:6px; font-size:12px; font-weight:bold; }        
.modal-content input, .modal-content select { width:95%; padding:6px; margin-top:2px; margin-bottom:6px; box-sizing:border-box; }        
.modal-content button { width:100%; margin-top:8px; }       
.input-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 8px;
}

#selectedDate {
  font-size: 14px;
  font-weight: bold;
}

.input-actions {
  display: flex;
  gap: 6px;
}

#pasteBtn {
  border: none;
  background: #f1f3f5;
  border-radius: 8px;
  font-size: 12px;
  cursor: pointer;
  padding: 0 8px;
  height: 32px;
  line-height: 32px;
}

#closeInputBtn {
  border: none;
  background: none;
  font-size: 18px;
  cursor: pointer;
}

button {
  border: none;
  outline: none;
  background: #f1f3f5;
  border-radius: 8px;
  padding: 6px 10px;
  cursor: pointer;
  align-items: center;
  justify-content: center;
    line-height: normal; 
     display: flex;
     height: 32px;
}


@media (max-width:600px){        
  #siteTitle { font-size:32px; }        
  #calendar { gap:2px; padding:2px 4px; margin-bottom:260px; }        
  #weekdays { gap:2px; padding:2px 4px; }        
  .day { min-height:110px; padding:4px 2px; }        
  .schedule { font-size:8.5px; padding:2px 2px; width:100%; box-sizing:border-box; }        
  #inputBox {
    position: fixed;
    bottom: env(safe-area-inset-bottom); /* iOS ëŒ€ì‘ */
    left: 0;
    width: 100%;
    height: 40vh;              /* â­ í•µì‹¬ */
    max-height: 40vh;
    padding:10px 10px 12px;    /* ì•„ë˜ ì—¬ë°± */
    box-sizing:border-box;
    border-top-left-radius:12px;
    border-top-right-radius:12px;
    background:white;
    box-shadow:0 -4px 12px rgba(0,0,0,0.15);
    overflow-y: auto;          /* â­ ë‚´ë¶€ ìŠ¤í¬ë¡¤ */
    -webkit-overflow-scrolling: touch;
    z-index:1000;
  }
  
   #prevBtn, #nextBtn, #todayBtn {
  height: 30px;        /* â­ ì„¸ë¡œ ì¤„ì´ê¸° */
  padding: 0 8px;
  font-size: 13px;
}
  
}
  #addBtn { float:right; margin-top:6px; }        
  #inputBox input, #inputBox select { width:100%; padding:6px; box-sizing:border-box; }        
  #inputBox label { font-size:12px; }        
  #closeInputBtn { font-size:18px; }        
  #editModal .modal-content { max-height:none; overflow-y:visible; padding:10px; }        
  #editModal .modal-content label { font-size:12px; }        
  #editModal .modal-content input, #editModal .modal-content select { font-size:12px; padding:4px; }        
  #editModal .modal-content button { font-size:12px; padding:6px 0; margin-top:4px; }        
       
@media (min-width:601px){ .schedule { font-size:13px; padding:4px 6px; } }        
@media (max-width:600px) {
  #todayBtn {
    right: 3px;   /* ê¸°ì¡´ 10px â†’ ì‚´ì§ ì˜¤ë¥¸ìª½ */
  }
}

</style>        
</head>        
<body>        
        
<header>        
  <div id="siteTitle">ğŸŒ™MOONBYUL SCHEDULEğŸŒŸ</div>        
  <div id="navControls">        
    <button id="prevBtn">â—€</button>        
    <span id="monthText"></span>        
    <button id="nextBtn">â–¶</button>        
    <button id="todayBtn">Today</button>        
  </div>        
</header>        
        
<div id="weekdays"></div>        
<div id="calendar"></div>        
        
<div id="inputBox">        
  <div class="input-header">
  <div id="selectedDate"></div>  
  <div class="input-actions">
  <button id="pasteBtn"> ë¶™ì—¬ë„£ê¸°</button>
  <button id="closeInputBtn">âœ–</button> 
    </div>   
  </div>    
<label>ì¼ì • ì œëª©</label><input id="titleInput" placeholder="ì¼ì • ì œëª©">        
  <label>ë§í¬ (ì„ íƒ)</label><input id="urlInput" placeholder="https://...">        
  <label>ê¸°ê°„</label>        
  <div class="date-row"><input id="startDateInput" type="date"><input id="endDateInput" type="date"></div>        
  <label>ìœ í˜•</label>        
  <select id="typeInput">        
    <option value="ê¸°íƒ€">ê¸°íƒ€</option>        
    <option value="ì½˜ì„œíŠ¸">ì½˜ì„œíŠ¸</option>        
    <option value="í–‰ì‚¬">í–‰ì‚¬</option>        
    <option value="ê¸°ë…ì¼">ê¸°ë…ì¼</option>        
    <option value="ë°©ì†¡">ë°©ì†¡</option>        
    <option value="íŒ¬ì‚¬ì¸íšŒ">íŒ¬ì‚¬ì¸íšŒ</option>        
    <option value="SNS">SNS</option>        
    <option value="ìœ íŠœë¸Œ">ìœ íŠœë¸Œ</option>        
  </select>        
  <label>ì¼ì • ë‚´ìš©</label><input id="descInput" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)">        
  <button id="addBtn">ì¶”ê°€</button>     
  </select>        
     
</div>        
        
<div id="actionModal" class="modal">        
  <div class="modal-content">        
    <div id="modalTitle" style="font-weight:bold; margin-bottom:4px;"></div>        
    <div id="modalDate" style="font-size:12.5px; margin-bottom:4px;"></div>        
    <div id="modalContent" style="font-size:12.5px; margin-bottom:6px;"></div>        
    <a id="modalLink" href="#" target="_blank" style="display:none; margin-bottom:6px;">ğŸ”— ë§í¬</a>        
    <div id="modalType" style="font-size:11px; margin-bottom:8px;"></div>        
    <button id="actionCopyBtn">ğŸ“‹ ë³µì‚¬</button>
    <button id="actionEditBtn">âœï¸ ìˆ˜ì •</button>        
    <button id="actionDeleteBtn">ğŸ—‘ï¸ ì‚­ì œ</button>        
    <button id="actionCancelBtn">âœ–ï¸ ì·¨ì†Œ</button>        
  </div>        
</div>        
        
<div id="editModal" class="modal">        
  <div class="modal-content">        
    <label>ì¼ì • ì œëª©</label><input id="editTitleInput">  
    <label>ì¼ì • ë‚´ìš© (ì„ íƒ)</label><input id="editDescInput">         
    <label>ë§í¬ (ì„ íƒ)</label><input id="editUrlInput">        
    <label>ê¸°ê°„</label><div class="date-row"><input id="editStartDateInput" type="date"><input id="editEndDateInput" type="date"></div>        
    <label>ìœ í˜•</label>        
    <select id="editTypeInput">        
      <option value="ê¸°íƒ€">ê¸°íƒ€</option>        
      <option value="ì½˜ì„œíŠ¸">ì½˜ì„œíŠ¸</option>        
      <option value="í–‰ì‚¬">í–‰ì‚¬</option> 
      <option value="ë°œë§¤">ë°œë§¤</option>       
      <option value="ê¸°ë…ì¼">ê¸°ë…ì¼</option>        
      <option value="ë°©ì†¡">ë°©ì†¡</option>        
      <option value="íŒ¬ì‚¬ì¸íšŒ">íŒ¬ì‚¬ì¸íšŒ</option>        
      <option value="SNS">SNS</option>        
      <option value="ìœ íŠœë¸Œ">ìœ íŠœë¸Œ</option>        
    </select>               
    <button id="saveEditBtn">ì €ì¥</button>        
    <button id="cancelEditBtn">ì·¨ì†Œ</button>        
  </div>        
</div>        
        
<script type="module">        
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";        
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";        
import { getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot, writeBatch } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";        
        
/******** Firebase ì´ˆê¸°í™” ********/        
const firebaseConfig = {        
    apiKey: "AIzaSyAqCsyAWQ-5wDYEqUuJWgZKCGRyMwDg-ds",        
    authDomain: "schedule-fc512.firebaseapp.com",        
    projectId: "schedule-fc512",        
    storageBucket: "schedule-fc512.firebasestorage.app",        
    messagingSenderId: "940626479946",        
    appId: "1:940626479946:web:a05efe8ed77b96cd30cfb3",        
    measurementId: "G-L6DES7RMV2"        
};        
const app = initializeApp(firebaseConfig);        
const analytics = getAnalytics(app);        
const db = getFirestore(app);        
const schedulesCol = collection(db, "schedules");        
        
/******** ìº˜ë¦°ë” ë³€ìˆ˜ ********/        
const calendar=document.getElementById("calendar");        
const weekdaysDiv=document.getElementById("weekdays");        
const monthText=document.getElementById("monthText");        
const inputBox=document.getElementById("inputBox");        
const selectedDateText=document.getElementById("selectedDate");        
        
const titleInput=document.getElementById("titleInput");        
const urlInput=document.getElementById("urlInput");        
const startDateInput=document.getElementById("startDateInput");        
const endDateInput=document.getElementById("endDateInput");        
const typeInput=document.getElementById("typeInput");        
const descInput=document.getElementById("descInput");        
        
const actionModal=document.getElementById("actionModal");        
const modalTitle=document.getElementById("modalTitle");        
const modalContent=document.getElementById("modalContent");        
const modalLink=document.getElementById("modalLink");        
const modalType=document.getElementById("modalType");        
const actionEditBtn=document.getElementById("actionEditBtn");        
const actionDeleteBtn=document.getElementById("actionDeleteBtn");        
const actionCancelBtn=document.getElementById("actionCancelBtn");        
const actionCopyBtn=document.getElementById("actionCopyBtn");


const editModal=document.getElementById("editModal");        
const editTitleInput=document.getElementById("editTitleInput");        
const editUrlInput=document.getElementById("editUrlInput");        
const editStartDateInput=document.getElementById("editStartDateInput");        
const editEndDateInput=document.getElementById("editEndDateInput");        
const editTypeInput=document.getElementById("editTypeInput");        
const editDescInput=document.getElementById("editDescInput");        
const saveEditBtn=document.getElementById("saveEditBtn");        
const cancelEditBtn=document.getElementById("cancelEditBtn");        
        
const prevBtn=document.getElementById("prevBtn");        
const nextBtn=document.getElementById("nextBtn");        
const todayBtn=document.getElementById("todayBtn");        
const addBtn=document.getElementById("addBtn");        
const closeInputBtn=document.getElementById("closeInputBtn");        
const pasteBtn=document.getElementById("pasteBtn");


const typeColors = {
  ì½˜ì„œíŠ¸: "#fb7185",   
  ìœ íŠœë¸Œ: "#fca5a5",   
  í–‰ì‚¬: "#D6C9FF",     
  ë°©ì†¡: "#BEEAD6",     
  íŒ¬ì‚¬ì¸íšŒ: "#c8edfd", 
  ë°œë§¤: "#6190fe",     
  ê¸°ë…ì¼: "#FFD59E",   
  SNS: "#fef08a",
  ê¸°íƒ€: "#e0e7ff"     
};       
        
let currentDate=new Date(), selectedDateKey=null, activeGroupId=null, dragSrcEl=null, firestoreData={};        
let copiedSchedule = null;
        
/******** Firestore ì‹¤ì‹œê°„ ********/        
onSnapshot(schedulesCol, snapshot=>{        
  firestoreData={};        
  snapshot.docs.forEach(docSnap=>{        
    const d=docSnap.data();        
    if(!firestoreData[d.date]) firestoreData[d.date]=[];        
    firestoreData[d.date].push({...d,id:docSnap.id});        
  });        
  renderCalendar();        
});        
        
/******** í—¬í¼ ********/        
const gid=()=>Math.random().toString(36).slice(2);        
const formatDate=k=>{ const [y,m,d]=k.split("-"); return `${y}-${String(m).padStart(2,"0")}-${String(d).padStart(2,"0")}`; };        
/******** ìº˜ë¦°ë” ë Œë”ë§, ë“œë˜ê·¸ í¬í•¨ ********/        
function renderCalendar(){        
  calendar.innerHTML=""; weekdaysDiv.innerHTML="";        
  const y=currentDate.getFullYear(), m=currentDate.getMonth();        
  monthText.textContent=`${y}ë…„ ${m+1}ì›”`;        
  ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "].forEach(d=>{        
    const w=document.createElement("div");        
    w.className="weekday";        
    w.textContent=d;        
    weekdaysDiv.appendChild(w);        
  });        
        
  const first=new Date(y,m,1).getDay();        
  const last=new Date(y,m+1,0).getDate();        
  const todayKey=`${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`;        
        
  for(let i=0;i<first;i++){        
    const e=document.createElement("div");        
    e.className="day";        
    e.style.visibility="hidden";        
    calendar.appendChild(e);        
  }        
        
  for(let d=1; d<=last; d++){        
    const key=`${y}-${m+1}-${d}`;        
    const day=document.createElement("div");        
    day.className="day";        
    if(key===todayKey) day.classList.add("today");        
    if(key===selectedDateKey) day.classList.add("selected");        
        
    const num=document.createElement("div");        
    num.className="day-number";        
    num.textContent=d;        
    day.appendChild(num);        
        
    const cont=document.createElement("div");        
    cont.className="schedule-container";        
        
    (firestoreData[key] || []).sort((a,b)=>(a.order??0)-(b.order??0)).forEach((it,idx)=>{        
      const s=document.createElement("div");        
      s.className="schedule";        
      s.dataset.index=idx;        
      s.dataset.dateKey=key;        
      s.style.background=typeColors[it.type]||"#e0e7ff";        
        
      if(it.url){        
        const linkIcon=document.createElement("span");        
        linkIcon.className="link-icon";        
        linkIcon.textContent="ğŸ”—";        
        linkIcon.onclick=e=>{ e.stopPropagation(); window.open(it.url,"_blank"); };        
        s.appendChild(linkIcon);        
      }        
      const titleSpan=document.createElement("span");        
      titleSpan.className="title";        
      titleSpan.textContent=it.title;        
      s.appendChild(titleSpan);        
        
      // í´ë¦­ ì‹œ ëª¨ë‹¬ í‘œì‹œ        
      s.onclick = e=>{        
        e.stopPropagation();        
        selectedDateKey=key;        
        activeGroupId=it.groupId;        
        
        const dates=[];        
        for(const k in firestoreData){        
          firestoreData[k].forEach(item=>{ if(item.groupId===it.groupId) dates.push(k); });        
        }        
        dates.sort((a,b)=>new Date(a)-new Date(b));        
        const startDate=dates[0];        
        const endDate=dates[dates.length-1];        
        
        modalTitle.textContent=it.title;        
        modalContent.textContent=it.content||"(ë‚´ìš© ì—†ìŒ)";        
        modalType.textContent=`ìœ í˜•: ${it.type}`;        
        modalLink.style.display=it.url?"block":"none";        
        if(it.url) modalLink.href=it.url;        
        
        document.getElementById("modalDate").textContent=startDate===endDate?startDate:`${startDate} ~ ${endDate}`;        
        actionModal.style.display="flex";        
      };        
        
      addWebDragEvents(s,key);        
      addMobileTouchDrag(s,cont,key);        
      cont.appendChild(s);        
    });        
        
    day.appendChild(cont);        
    day.onclick = () => {
  if (selectedDateKey === key) {
    selectedDateText.textContent = `${m+1}ì›” ${d}ì¼`;
    startDateInput.value = endDateInput.value = formatDate(key);

    // â­â­â­ ì—¬ê¸° ì¶”ê°€ â­â­â­
    titleInput.value = "";
    urlInput.value = "";
    descInput.value = "";
    typeInput.value = "ê¸°íƒ€";

    inputBox.style.display = "block";
    return;
  }

  selectedDateKey = key;
  inputBox.style.display = "none";
  document.querySelectorAll(".day").forEach(x => x.classList.remove("selected"));
  day.classList.add("selected");
};    
    calendar.appendChild(day);        
  }        
}        
        
/******** ë“œë˜ê·¸/í„°ì¹˜ êµ¬í˜„ ********/        
function addWebDragEvents(el,dateKey){        
  el.setAttribute("draggable","true");        
  el.addEventListener("dragstart",()=>{ dragSrcEl=el; el.classList.add("dragging"); });        
  el.addEventListener("dragend",()=>{ el.classList.remove("dragging"); dragSrcEl=null; });        
  el.addEventListener("dragover",e=>e.preventDefault());        
  el.addEventListener("drop",async e=>{        
    e.preventDefault(); if(!dragSrcEl||dragSrcEl===el) return;        
    const d=firestoreData[dateKey];        
    const from=+dragSrcEl.dataset.index, to=+el.dataset.index;        
    d.splice(to,0,d.splice(from,1)[0]);        
    const batch = writeBatch(db);        
    d.forEach((item,i)=>{ batch.set(doc(schedulesCol,item.id),{...item,order:i}); });        
    await batch.commit();        
  });        
}        
        
function addMobileTouchDrag(el, container, dateKey) {        
  let startY = 0, startIndex = 0, moved = false;        
        
  el.addEventListener("touchstart", e => {        
    dragSrcEl = el;        
    startY = e.touches[0].clientY;        
    startIndex = +el.dataset.index;        
    moved = false;        
    el.classList.add("dragging");        
  });        
        
  el.addEventListener("touchmove", e => {        
    const deltaY = e.touches[0].clientY - startY;        
    if (Math.abs(deltaY) > 5) moved = true;        
        
    if (moved) {        
      e.preventDefault(); // í™”ë©´ ìŠ¤í¬ë¡¤ ë°©ì§€        
      el.style.transform = `translateY(${deltaY}px) scale(0.95)`;        
    }        
  }, { passive: false }); // passive:false í•„ìˆ˜!        
        
  el.addEventListener("touchend", async e => {        
    el.style.transform = "";        
    el.classList.remove("dragging");        
        
    if (moved) {        
      const rects = Array.from(container.children).map(c => c.getBoundingClientRect());        
      const centerY = rects[startIndex].top + rects[startIndex].height / 2 + (e.changedTouches[0].clientY - startY);        
      let newIndex = rects.findIndex(r => centerY < r.top + r.height / 2);        
      if (newIndex === -1) newIndex = container.children.length - 1;        
        
      if (newIndex !== startIndex) {        
        const d = firestoreData[dateKey];        
        d.splice(newIndex, 0, d.splice(startIndex, 1)[0]);        
        const batch = writeBatch(db);        
        d.forEach((item, i) => {        
          batch.set(doc(schedulesCol, item.id), { ...item, order: i });        
        });        
        await batch.commit();        
      }        
    }        
        
    dragSrcEl = null;        
  });        
}        
        
/******** ì¼ì • ì¶”ê°€ ********/ 
pasteBtn.onclick = () => {
  if (!copiedSchedule || !selectedDateKey) {
    alert("ë³µì‚¬ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  // 1ï¸âƒ£ ë³µì‚¬ëœ ì¼ì • ë‚ ì§œìˆœ ì •ë ¬
  const sorted = [...copiedSchedule].sort(
    (a, b) => new Date(a.date) - new Date(b.date)
  );

  const first = sorted[0];
  const last = sorted[sorted.length - 1];

  // 2ï¸âƒ£ ì…ë ¥ì°½ì— ê°’ ì±„ìš°ê¸°
  titleInput.value = first.title || "";
  urlInput.value = first.url || "";
  descInput.value = first.content || "";
  typeInput.value = first.type || "ê¸°íƒ€";

  // 3ï¸âƒ£ â­ ë‚ ì§œ ë³´ì • (ì„ íƒí•œ ë‚ ì§œ ê¸°ì¤€)
  const base = new Date(selectedDateKey);
  const duration = sorted.length - 1;

  startDateInput.value = formatDate(
    `${base.getFullYear()}-${base.getMonth()+1}-${base.getDate()}`
  );

  const end = new Date(base);
  end.setDate(base.getDate() + duration);

  endDateInput.value = formatDate(
    `${end.getFullYear()}-${end.getMonth()+1}-${end.getDate()}`
  );

  // 4ï¸âƒ£ ì…ë ¥ì°½ ì—´ê¸°
const [y, m, d] = selectedDateKey.split("-");
selectedDateText.textContent = `${m}ì›” ${d}ì¼`;
inputBox.style.display = "block";

};


addBtn.onclick=async ()=>{        
  if(!titleInput.value||!startDateInput.value) return;        
  const batch = writeBatch(db);        
  const groupId=gid();        
  let start=new Date(startDateInput.value), end=endDateInput.value?new Date(endDateInput.value):new Date(start);        
  if(start>end)[start,end]=[end,start];        
  let cur=new Date(start);        
  while(cur<=end){        
    const key=`${cur.getFullYear()}-${cur.getMonth()+1}-${cur.getDate()}`;        
    const docRef=doc(schedulesCol);        
    const order=(firestoreData[key]?.length||0);        
    batch.set(docRef,{        
      title:titleInput.value,        
      url:urlInput.value||"",        
      type:typeInput.value,        
      content:descInput.value||"",        
      date:key,        
      groupId,        
      order        
    });        
    cur.setDate(cur.getDate()+1);        
  }        
  await batch.commit();        
  inputBox.style.display="none"; titleInput.value=urlInput.value=descInput.value=""; startDateInput.value=endDateInput.value=""; typeInput.value="";        
};        
        
/******** ìˆ˜ì •/ì‚­ì œ ********/  
actionCopyBtn.onclick = () => {
  const items = [];

  for (const k in firestoreData) {
    firestoreData[k].forEach(it => {
      if (it.groupId === activeGroupId) {
        items.push({ ...it });
      }
    });
  }

  if (items.length === 0) return;

  copiedSchedule = items;

  alert("ì¼ì •ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
  actionModal.style.display = "none";
};

actionEditBtn.onclick=()=>{        
  const items=[];        
  for(const k in firestoreData){        
    firestoreData[k].forEach(it=>{ if(it.groupId===activeGroupId) items.push({...it,date:k}); });        
  }        
  if(items.length===0) return;        
  items.sort((a,b)=>new Date(a.date)-new Date(b.date));        
  const first=items[0], last=items[items.length-1];        
  editTitleInput.value=first.title;        
  editUrlInput.value=first.url||"";        
  editTypeInput.value=first.type;        
  editDescInput.value=first.content||"";        
  editStartDateInput.value=formatDate(first.date);        
  editEndDateInput.value=formatDate(last.date);        
  actionModal.style.display="none";        
  editModal.style.display="flex";        
};        
        
saveEditBtn.onclick=async ()=>{        
  const groupItems=[];        
  for(const k in firestoreData) firestoreData[k].forEach(it=>{ if(it.groupId===activeGroupId) groupItems.push(it); });        
  const batch=writeBatch(db);        
  groupItems.forEach(it=>{ batch.delete(doc(schedulesCol,it.id)); });        
  let start=new Date(editStartDateInput.value), end=new Date(editEndDateInput.value);        
  if(start>end)[start,end]=[end,start];        
  const groupId=activeGroupId;        
  let cur=new Date(start);        
  while(cur<=end){        
    const key=`${cur.getFullYear()}-${cur.getMonth()+1}-${cur.getDate()}`;        
    const docRef=doc(schedulesCol);        
    batch.set(docRef,{        
      title:editTitleInput.value,        
      url:editUrlInput.value||"",        
      type:editTypeInput.value,        
      content:editDescInput.value||"",        
      date:key,        
      groupId        
    });        
    cur.setDate(cur.getDate()+1);        
  }        
  await batch.commit(); editModal.style.display="none";        
};        
        
actionDeleteBtn.onclick=async ()=>{        
  if(!confirm("ì—°ì† ì¼ì • ì „ì²´ë¥¼ ì‚­ì œí• ê¹Œìš”?")) return;        
  const batch=writeBatch(db);        
  for(const k in firestoreData) firestoreData[k].forEach(it=>{ if(it.groupId===activeGroupId) batch.delete(doc(schedulesCol,it.id)); });        
  await batch.commit(); actionModal.style.display="none";        
};        
        
/******** ëª¨ë‹¬ ë‹«ê¸° ********/        
closeInputBtn.onclick=()=>inputBox.style.display="none";        
actionCancelBtn.onclick=()=>actionModal.style.display="none";        
cancelEditBtn.onclick=()=>editModal.style.display="none";        
        
/******** ì´ì „/ë‹¤ìŒ/Today ********/        
prevBtn.onclick=()=>{ currentDate.setMonth(currentDate.getMonth()-1); renderCalendar(); };        
nextBtn.onclick=()=>{ currentDate.setMonth(currentDate.getMonth()+1); renderCalendar(); };        
todayBtn.onclick=()=>{        
  const t=new Date();        
  currentDate=new Date(t.getFullYear(),t.getMonth(),1);        
  selectedDateKey=`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`;        
  renderCalendar();        
};        
        
/******** ì—°/ì›” ì„ íƒ ëª¨ë‹¬ ********/        
const monthPickerModal=document.getElementById("monthPickerModal");        
const yearSelect=document.getElementById("yearSelect");        
const monthSelect=document.getElementById("monthSelect");        
const applyMonthBtn=document.getElementById("applyMonthBtn");        
const cancelMonthBtn=document.getElementById("cancelMonthBtn");        
        
function fillYearOptions(){        
  yearSelect.innerHTML="";        
  const currentYear=new Date().getFullYear();        
  for(let y=currentYear-50; y<=currentYear+50; y++){        
    const opt=document.createElement("option");        
    opt.value=y; opt.textContent=`${y}ë…„`; yearSelect.appendChild(opt);        
  }        
}        
        
monthText.style.cursor="pointer";        
monthText.onclick=()=>{        
  fillYearOptions();        
  yearSelect.value=currentDate.getFullYear();        
  monthSelect.value=currentDate.getMonth();        
  monthPickerModal.style.display="flex";        
};        
        
applyMonthBtn.onclick=()=>{        
  const y=parseInt(yearSelect.value);        
  const m=parseInt(monthSelect.value);        
  currentDate=new Date(y,m,1);        
  selectedDateKey=null;        
  monthPickerModal.style.display="none";        
  renderCalendar();        
};        
        
cancelMonthBtn.onclick=()=>{ monthPickerModal.style.display="none"; };        
</script>        
        
<div id="monthPickerModal" class="modal">        
  <div class="modal-content">        
    <label>ì—°ë„</label>        
    <select id="yearSelect"></select>        
    <label>ì›”</label>        
    <select id="monthSelect">        
      <option value="0">1ì›”</option><option value="1">2ì›”</option><option value="2">3ì›”</option><option value="3">4ì›”</option>        
      <option value="4">5ì›”</option><option value="5">6ì›”</option><option value="6">7ì›”</option><option value="7">8ì›”</option>        
      <option value="8">9ì›”</option><option value="9">10ì›”</option><option value="10">11ì›”</option><option value="11">12ì›”</option>        
    </select>        
    <button id="applyMonthBtn">ì´ë™</button>        
    <button id="cancelMonthBtn">ì·¨ì†Œ</button>        
  </div>        
</div>        
        
</body>        
</html>
